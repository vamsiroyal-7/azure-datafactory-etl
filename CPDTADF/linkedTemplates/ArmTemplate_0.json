{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"factoryName": {
			"type": "string",
			"metadata": "Data Factory name",
			"defaultValue": "CPDTADF"
		},
		"AzureSqlDatabase1_password": {
			"type": "secureString",
			"metadata": "Secure string for 'password' of 'AzureSqlDatabase1'"
		},
		"AzureSqlDatabase2_password": {
			"type": "secureString",
			"metadata": "Secure string for 'password' of 'AzureSqlDatabase2'"
		},
		"AzureSqlDatabase1_properties_typeProperties_server": {
			"type": "string",
			"defaultValue": "cpdt.database.windows.net"
		},
		"AzureSqlDatabase1_properties_typeProperties_database": {
			"type": "string",
			"defaultValue": "cpdt"
		},
		"AzureSqlDatabase1_properties_typeProperties_userName": {
			"type": "string",
			"defaultValue": "cpdt"
		},
		"AzureSqlDatabase2_properties_typeProperties_server": {
			"type": "string",
			"defaultValue": "cpdt.database.windows.net"
		},
		"AzureSqlDatabase2_properties_typeProperties_database": {
			"type": "string",
			"defaultValue": "cpdt"
		},
		"AzureSqlDatabase2_properties_typeProperties_userName": {
			"type": "string",
			"defaultValue": "cpdt"
		}
	},
	"variables": {
		"factoryId": "[concat('Microsoft.DataFactory/factories/', parameters('factoryName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('factoryName'), '/AzureSqlDatabase1')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"type": "AzureSqlDatabase",
				"typeProperties": {
					"server": "[parameters('AzureSqlDatabase1_properties_typeProperties_server')]",
					"database": "[parameters('AzureSqlDatabase1_properties_typeProperties_database')]",
					"encrypt": "mandatory",
					"trustServerCertificate": false,
					"authenticationType": "SQL",
					"userName": "[parameters('AzureSqlDatabase1_properties_typeProperties_userName')]",
					"password": {
						"type": "SecureString",
						"value": "[parameters('AzureSqlDatabase1_password')]"
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/AzureSqlDatabase2')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"type": "AzureSqlDatabase",
				"typeProperties": {
					"server": "[parameters('AzureSqlDatabase2_properties_typeProperties_server')]",
					"database": "[parameters('AzureSqlDatabase2_properties_typeProperties_database')]",
					"encrypt": "mandatory",
					"trustServerCertificate": false,
					"authenticationType": "SQL",
					"userName": "[parameters('AzureSqlDatabase2_properties_typeProperties_userName')]",
					"password": {
						"type": "SecureString",
						"value": "[parameters('AzureSqlDatabase2_password')]"
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/Destination_Table')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "AzureSqlDatabase2",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [
					{
						"name": "Business_Unit_KEY",
						"type": "int",
						"precision": 10
					},
					{
						"name": "Business_Unit",
						"type": "varchar"
					},
					{
						"name": "Block_ID",
						"type": "varchar"
					},
					{
						"name": "Area_Classification_1",
						"type": "varchar"
					},
					{
						"name": "Area_Classification_2",
						"type": "varchar"
					},
					{
						"name": "Plant_ID",
						"type": "varchar"
					},
					{
						"name": "Plant_ID2",
						"type": "varchar"
					},
					{
						"name": "Asset_Owner",
						"type": "varchar"
					},
					{
						"name": "Cost_Center",
						"type": "varchar"
					},
					{
						"name": "Tier_Classification",
						"type": "varchar"
					},
					{
						"name": "Comments",
						"type": "varchar"
					},
					{
						"name": "Business_Justification",
						"type": "varchar"
					},
					{
						"name": "Attachments",
						"type": "varchar"
					},
					{
						"name": "Begin_Date",
						"type": "date"
					},
					{
						"name": "End_Date",
						"type": "date"
					},
					{
						"name": "Current_Rec_In",
						"type": "int",
						"precision": 10
					},
					{
						"name": "Field_Engineer_Name",
						"type": "varchar"
					},
					{
						"name": "Field_Engineer_Remarks",
						"type": "varchar"
					},
					{
						"name": "Approver_1_Name",
						"type": "varchar"
					},
					{
						"name": "Approver_1_Remarks",
						"type": "varchar"
					},
					{
						"name": "Approver_1_Timestamp",
						"type": "datetime",
						"precision": 23,
						"scale": 3
					},
					{
						"name": "Approver_2_Name",
						"type": "varchar"
					},
					{
						"name": "Approver_2_Remarks",
						"type": "varchar"
					},
					{
						"name": "Approver_2_Timestamp",
						"type": "datetime",
						"precision": 23,
						"scale": 3
					},
					{
						"name": "Created_By",
						"type": "varchar"
					},
					{
						"name": "Created_Timestamp",
						"type": "datetime",
						"precision": 23,
						"scale": 3
					},
					{
						"name": "Updated_By",
						"type": "varchar"
					},
					{
						"name": "Updated_Timestamp",
						"type": "datetime",
						"precision": 23,
						"scale": 3
					}
				],
				"typeProperties": {
					"schema": "CP_OLAP",
					"table": "CP_Area_Dimension"
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/AzureSqlDatabase2')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/Source_Table')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "AzureSqlDatabase1",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [
					{
						"name": "Business_Unit_ID",
						"type": "int",
						"precision": 10
					},
					{
						"name": "Business_Unit",
						"type": "varchar"
					},
					{
						"name": "Block_ID",
						"type": "varchar"
					},
					{
						"name": "Area_Classification_1",
						"type": "varchar"
					},
					{
						"name": "Area_Classification_2",
						"type": "varchar"
					},
					{
						"name": "Plant_ID",
						"type": "varchar"
					},
					{
						"name": "Plant_ID2",
						"type": "varchar"
					},
					{
						"name": "Asset_Owner",
						"type": "varchar"
					},
					{
						"name": "Cost_Center",
						"type": "varchar"
					},
					{
						"name": "Tier_Classification",
						"type": "varchar"
					},
					{
						"name": "Comments",
						"type": "varchar"
					},
					{
						"name": "Business_Justification",
						"type": "varchar"
					},
					{
						"name": "Attachments",
						"type": "varchar"
					},
					{
						"name": "Status",
						"type": "varchar"
					},
					{
						"name": "Field_Engineer",
						"type": "varchar"
					},
					{
						"name": "Field_Engineer_Remarks",
						"type": "varchar"
					},
					{
						"name": "Approver_1_Name",
						"type": "varchar"
					},
					{
						"name": "Approver_1_Remarks",
						"type": "varchar"
					},
					{
						"name": "Approver_1_Timestamp",
						"type": "datetime",
						"precision": 23,
						"scale": 3
					},
					{
						"name": "Approver_2_Name",
						"type": "varchar"
					},
					{
						"name": "Approver_2_Remarks",
						"type": "varchar"
					},
					{
						"name": "Approver_2_Timestamp",
						"type": "datetime",
						"precision": 23,
						"scale": 3
					},
					{
						"name": "Created_By",
						"type": "varchar"
					},
					{
						"name": "Created_Timestamp",
						"type": "datetime",
						"precision": 23,
						"scale": 3
					},
					{
						"name": "Updated_By",
						"type": "varchar"
					},
					{
						"name": "Updated_Timestamp",
						"type": "datetime",
						"precision": 23,
						"scale": 3
					}
				],
				"typeProperties": {
					"schema": "CP_OLTP",
					"table": "CP_Area_Config_Master"
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/AzureSqlDatabase1')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/CP_DF_AreaConfig')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "Source_Table",
								"type": "DatasetReference"
							},
							"name": "OLTPDataSource"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "Destination_Table",
								"type": "DatasetReference"
							},
							"name": "OLAPDimensionLoad"
						}
					],
					"transformations": [
						{
							"name": "AlterRow"
						},
						{
							"name": "StatusFilter"
						},
						{
							"name": "TrimCap",
							"description": "This Derived Column activity trims leading and trailing spaces from the string columns and converts its first letter to uppercase while keeping the rest of the characters as is, ensuring consistent formatting before further processing."
						}
					],
					"scriptLines": [
						"source(output(",
						"          Business_Unit_ID as integer,",
						"          Business_Unit as string,",
						"          Block_ID as string,",
						"          Area_Classification_1 as string,",
						"          Area_Classification_2 as string,",
						"          Plant_ID as string,",
						"          Plant_ID2 as string,",
						"          Asset_Owner as string,",
						"          Cost_Center as string,",
						"          Tier_Classification as string,",
						"          Comments as string,",
						"          Business_Justification as string,",
						"          Attachments as string,",
						"          Status as string,",
						"          Field_Engineer as string,",
						"          Field_Engineer_Remarks as string,",
						"          Approver_1_Name as string,",
						"          Approver_1_Remarks as string,",
						"          Approver_1_Timestamp as timestamp,",
						"          Approver_2_Name as string,",
						"          Approver_2_Remarks as string,",
						"          Approver_2_Timestamp as timestamp,",
						"          Created_By as string,",
						"          Created_Timestamp as timestamp,",
						"          Updated_By as string,",
						"          Updated_Timestamp as timestamp",
						"     ),",
						"     allowSchemaDrift: true,",
						"     validateSchema: false,",
						"     isolationLevel: 'READ_UNCOMMITTED',",
						"     format: 'table') ~> OLTPDataSource",
						"StatusFilter alterRow(upsertIf(!isNull(Business_Unit_ID)),",
						"     insertIf(isNull(Business_Unit_ID))) ~> AlterRow",
						"TrimCap filter(Status == 'Approved') ~> StatusFilter",
						"OLTPDataSource derive(each(match(\"type\"==\"string\"), $$ = trim($$)),",
						"          each(match(\"type\"==\"string\"), $$ = initCap($$))) ~> TrimCap",
						"AlterRow sink(allowSchemaDrift: true,",
						"     validateSchema: true,",
						"     input(",
						"          Business_Unit_KEY as integer,",
						"          Business_Unit as string,",
						"          Block_ID as string,",
						"          Area_Classification_1 as string,",
						"          Area_Classification_2 as string,",
						"          Plant_ID as string,",
						"          Plant_ID2 as string,",
						"          Asset_Owner as string,",
						"          Cost_Center as string,",
						"          Tier_Classification as string,",
						"          Comments as string,",
						"          Business_Justification as string,",
						"          Attachments as string,",
						"          Begin_Date as date,",
						"          End_Date as date,",
						"          Current_Rec_In as integer,",
						"          Field_Engineer_Name as string,",
						"          Field_Engineer_Remarks as string,",
						"          Approver_1_Name as string,",
						"          Approver_1_Remarks as string,",
						"          Approver_1_Timestamp as timestamp,",
						"          Approver_2_Name as string,",
						"          Approver_2_Remarks as string,",
						"          Approver_2_Timestamp as timestamp,",
						"          Created_By as string,",
						"          Created_Timestamp as timestamp,",
						"          Updated_By as string,",
						"          Updated_Timestamp as timestamp",
						"     ),",
						"     deletable:false,",
						"     insertable:true,",
						"     updateable:false,",
						"     upsertable:true,",
						"     keys:['Business_Unit_KEY'],",
						"     format: 'table',",
						"     errorHandlingOption: 'stopOnFirstError',",
						"     mapColumn(",
						"          Business_Unit_KEY = Business_Unit_ID,",
						"          Business_Unit,",
						"          Block_ID,",
						"          Area_Classification_1,",
						"          Area_Classification_2,",
						"          Plant_ID,",
						"          Plant_ID2,",
						"          Asset_Owner,",
						"          Cost_Center,",
						"          Tier_Classification,",
						"          Comments,",
						"          Business_Justification,",
						"          Attachments,",
						"          Field_Engineer_Name = Field_Engineer,",
						"          Field_Engineer_Remarks,",
						"          Approver_1_Name,",
						"          Approver_1_Remarks,",
						"          Approver_1_Timestamp,",
						"          Approver_2_Name,",
						"          Approver_2_Remarks,",
						"          Approver_2_Timestamp,",
						"          Created_By,",
						"          Created_Timestamp,",
						"          Updated_By,",
						"          Updated_Timestamp",
						"     )) ~> OLAPDimensionLoad"
					]
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/Source_Table')]",
				"[concat(variables('factoryId'), '/datasets/Destination_Table')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/CP_PL_AreaConfig')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "AreaConfig",
						"type": "ExecuteDataFlow",
						"dependsOn": [],
						"policy": {
							"timeout": "0.12:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"dataflow": {
								"referenceName": "CP_DF_AreaConfig",
								"type": "DataFlowReference",
								"parameters": {},
								"datasetParameters": {
									"OLTPDataSource": {},
									"OLAPDimensionLoad": {}
								}
							},
							"staging": {},
							"compute": {
								"coreCount": 8,
								"computeType": "General"
							},
							"traceLevel": "Fine"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {}
				},
				"annotations": [],
				"lastPublishTime": "2025-05-17T18:41:57Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/dataflows/CP_DF_AreaConfig')]"
			]
		}
	]
}