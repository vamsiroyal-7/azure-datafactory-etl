{
	"name": "CP_DF_AreaConfig",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "Source_Table",
						"type": "DatasetReference"
					},
					"name": "OLTPDataSource"
				},
				{
					"dataset": {
						"referenceName": "AzureSqlTable1",
						"type": "DatasetReference"
					},
					"name": "Lookuptable"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "AzureSqlTable2",
						"type": "DatasetReference"
					},
					"name": "Destination",
					"description": "Destination"
				}
			],
			"transformations": [
				{
					"name": "StatusFilter"
				},
				{
					"name": "FormatString",
					"description": "This Derived Column activity ensures consistent formatting by trimming leading and trailing spaces from all string columns. Additionally, it capitalizes only the first letter of each value while keeping the rest of the text unchanged. This transformation helps maintain standardized data before further processing\n"
				},
				{
					"name": "LookupExistingRecords"
				},
				{
					"name": "DetectChangesAlterRow"
				},
				{
					"name": "surrogateKey1"
				},
				{
					"name": "SelectBeforeSurrogateKey"
				},
				{
					"name": "DefaultValues",
					"description": "DefaultValues"
				}
			],
			"scriptLines": [
				"source(output(",
				"          Business_Unit_ID as integer,",
				"          Business_Unit as string,",
				"          Block_ID as string,",
				"          Area_Classification_1 as string,",
				"          Area_Classification_2 as string,",
				"          Plant_ID as string,",
				"          Plant_ID2 as string,",
				"          Asset_Owner as string,",
				"          Cost_Center as string,",
				"          Tier_Classification as string,",
				"          Comments as string,",
				"          Business_Justification as string,",
				"          Attachments as string,",
				"          Status as string,",
				"          Field_Engineer as string,",
				"          Field_Engineer_Remarks as string,",
				"          Approver_1_Name as string,",
				"          Approver_1_Remarks as string,",
				"          Approver_1_Timestamp as timestamp,",
				"          Approver_2_Name as string,",
				"          Approver_2_Remarks as string,",
				"          Approver_2_Timestamp as timestamp,",
				"          Created_By as string,",
				"          Created_Timestamp as timestamp,",
				"          Updated_By as string,",
				"          Updated_Timestamp as timestamp",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     format: 'table') ~> OLTPDataSource",
				"source(output(",
				"          Business_Unit as string,",
				"          Block_ID as string,",
				"          Area_Classification_1 as string,",
				"          Area_Classification_2 as string,",
				"          Plant_ID as string,",
				"          Plant_ID2 as string,",
				"          Asset_Owner as string,",
				"          Cost_Center as string,",
				"          Tier_Classification as string,",
				"          Comments as string,",
				"          Business_Justification as string,",
				"          Attachments as string,",
				"          Begin_Date as date,",
				"          End_Date as date,",
				"          Current_Rec_In as integer,",
				"          Field_Engineer_Name as string,",
				"          Field_Engineer_Remarks as string,",
				"          Approver_1_Name as string,",
				"          Approver_1_Remarks as string,",
				"          Approver_1_Timestamp as timestamp,",
				"          Approver_2_Name as string,",
				"          Approver_2_Remarks as string,",
				"          Approver_2_Timestamp as timestamp,",
				"          Created_By as string,",
				"          Created_Timestamp as timestamp,",
				"          Updated_By as string,",
				"          Updated_Timestamp as timestamp,",
				"          Business_Unit_ID as integer",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     format: 'table') ~> Lookuptable",
				"FormatString filter(Status == 'Approved') ~> StatusFilter",
				"OLTPDataSource derive(Block_ID = upper(left(trim(Block_ID), 1)) + right(trim(Block_ID), length(trim(Block_ID)) - 1),",
				"          Business_Unit = upper(left(trim(Business_Unit), 1)) + right(trim(Business_Unit), length(trim(Business_Unit)) - 1),",
				"          Area_Classification_1 = upper(left(trim(Area_Classification_1), 1)) + right(trim(Area_Classification_1), length(trim(Area_Classification_1)) - 1),",
				"          Area_Classification_2 = upper(left(trim(Area_Classification_2), 1)) + right(trim(Area_Classification_2), length(trim(Area_Classification_2)) - 1),",
				"          Plant_ID = upper(left(trim(Plant_ID), 1)) + right(trim(Plant_ID), length(trim(Plant_ID)) - 1),",
				"          Plant_ID2 = upper(left(trim(Plant_ID2), 1)) + right(trim(Plant_ID2), length(trim(Plant_ID2)) - 1),",
				"          Tier_Classification = upper(left(trim(Tier_Classification), 1)) + right(trim(Tier_Classification), length(trim(Tier_Classification)) - 1),",
				"          Asset_Owner = upper(left(trim(Asset_Owner), 1)) + right(trim(Asset_Owner), length(trim(Asset_Owner)) - 1),",
				"          Cost_Center = upper(left(trim(Cost_Center), 1)) + right(trim(Cost_Center), length(trim(Cost_Center)) - 1),",
				"          Comments = upper(left(trim(Comments), 1)) + right(trim(Comments), length(trim(Comments)) - 1),",
				"          Field_Engineer = upper(left(trim(Field_Engineer), 1)) + right(trim(Field_Engineer), length(trim(Field_Engineer)) - 1),",
				"          Approver_1_Name = upper(left(trim(Approver_1_Name), 1)) + right(trim(Approver_1_Name), length(trim(Approver_1_Name)) - 1),",
				"          Field_Engineer_Remarks = upper(left(trim(Field_Engineer_Remarks), 1)) + right(trim(Field_Engineer_Remarks), length(trim(Field_Engineer_Remarks)) - 1),",
				"          Approver_1_Remarks = upper(left(trim(Approver_1_Remarks), 1)) + right(trim(Approver_1_Remarks), length(trim(Approver_1_Remarks)) - 1),",
				"          Approver_2_Name = upper(left(trim(Approver_2_Name), 1)) + right(trim(Approver_2_Name), length(trim(Approver_2_Name)) - 1),",
				"          Approver_2_Remarks = upper(left(trim(Approver_2_Remarks), 1)) + right(trim(Approver_2_Remarks), length(trim(Approver_2_Remarks)) - 1),",
				"          Business_Justification = upper(left(trim(Business_Justification), 1)) + right(trim(Business_Justification), length(trim(Business_Justification)) - 1)) ~> FormatString",
				"StatusFilter, Lookuptable lookup(OLTPDataSource@Business_Unit_ID == Lookuptable@Business_Unit_ID",
				"     && FormatString@Business_Unit == Lookuptable@Business_Unit",
				"     && FormatString@Block_ID == Lookuptable@Block_ID",
				"     && FormatString@Area_Classification_1 == Lookuptable@Area_Classification_1",
				"     && FormatString@Area_Classification_2 == Lookuptable@Area_Classification_2",
				"     && FormatString@Plant_ID == Lookuptable@Plant_ID",
				"     && FormatString@Plant_ID2 == Lookuptable@Plant_ID2",
				"     && FormatString@Cost_Center == Lookuptable@Cost_Center,",
				"     multiple: true,",
				"     broadcast: 'auto')~> LookupExistingRecords",
				"LookupExistingRecords alterRow(insertIf(isNull(Lookuptable@Business_Unit_ID) || ",
				"iif(isNull(FormatString@Business_Unit), '', FormatString@Business_Unit) != iif(isNull(Lookuptable@Business_Unit), '', Lookuptable@Business_Unit) || ",
				"iif(isNull(FormatString@Block_ID), '', FormatString@Block_ID) != iif(isNull(Lookuptable@Block_ID), '', Lookuptable@Block_ID) || ",
				"iif(isNull(FormatString@Area_Classification_1), '', FormatString@Area_Classification_1) != iif(isNull(Lookuptable@Area_Classification_1), '', Lookuptable@Area_Classification_1) || ",
				"iif(isNull(FormatString@Area_Classification_2), '', FormatString@Area_Classification_2) != iif(isNull(Lookuptable@Area_Classification_2), '', Lookuptable@Area_Classification_2) || ",
				"iif(isNull(FormatString@Plant_ID), '', FormatString@Plant_ID) != iif(isNull(Lookuptable@Plant_ID), '', Lookuptable@Plant_ID) || ",
				"iif(isNull(FormatString@Plant_ID2), '', FormatString@Plant_ID2) != iif(isNull(Lookuptable@Plant_ID2), '', Lookuptable@Plant_ID2) || ",
				"iif(isNull(FormatString@Asset_Owner), '', FormatString@Asset_Owner) != iif(isNull(Lookuptable@Asset_Owner), '', Lookuptable@Asset_Owner) || ",
				"iif(isNull(FormatString@Cost_Center), '', FormatString@Cost_Center) != iif(isNull(Lookuptable@Cost_Center), '', Lookuptable@Cost_Center)",
				"),",
				"     updateIf(!isNull(Lookuptable@Business_Unit_ID) && (     iif(isNull(FormatString@Business_Unit), '', FormatString@Business_Unit) != iif(isNull(Lookuptable@Business_Unit), '', Lookuptable@Business_Unit) ||      iif(isNull(FormatString@Block_ID), '', FormatString@Block_ID) != iif(isNull(Lookuptable@Block_ID), '', Lookuptable@Block_ID) ||      iif(isNull(FormatString@Area_Classification_1), '', FormatString@Area_Classification_1) != iif(isNull(Lookuptable@Area_Classification_1), '', Lookuptable@Area_Classification_1) ||      iif(isNull(FormatString@Area_Classification_2), '', FormatString@Area_Classification_2) != iif(isNull(Lookuptable@Area_Classification_2), '', Lookuptable@Area_Classification_2) ||      iif(isNull(FormatString@Plant_ID), '', FormatString@Plant_ID) != iif(isNull(Lookuptable@Plant_ID), '', Lookuptable@Plant_ID) ||      iif(isNull(FormatString@Plant_ID2), '', FormatString@Plant_ID2) != iif(isNull(Lookuptable@Plant_ID2), '', Lookuptable@Plant_ID2) ||      iif(isNull(FormatString@Asset_Owner), '', FormatString@Asset_Owner) != iif(isNull(Lookuptable@Asset_Owner), '', Lookuptable@Asset_Owner) ||      iif(isNull(FormatString@Cost_Center), '', FormatString@Cost_Center) != iif(isNull(Lookuptable@Cost_Center), '', Lookuptable@Cost_Center) ))) ~> DetectChangesAlterRow",
				"SelectBeforeSurrogateKey keyGenerate(output(Business_Unit_key as long),",
				"     startAt: 1L,",
				"     stepValue: 1L) ~> surrogateKey1",
				"DetectChangesAlterRow select(mapColumn(",
				"          each(match(/* All input columns */ true()),",
				"               /* Input name */ $$ = $$),",
				"          Business_Unit_ID = Lookuptable@Business_Unit_ID,",
				"          Business_Unit = Lookuptable@Business_Unit,",
				"          Block_ID = Lookuptable@Block_ID,",
				"          Area_Classification_1 = Lookuptable@Area_Classification_1,",
				"          Plant_ID = Lookuptable@Plant_ID,",
				"          Plant_ID2 = Lookuptable@Plant_ID2,",
				"          Asset_Owner = Lookuptable@Asset_Owner,",
				"          Cost_Center = Lookuptable@Tier_Classification,",
				"          Tier_Classification = FormatString@Tier_Classification,",
				"          Comments = FormatString@Comments,",
				"          Business_Justification = FormatString@Business_Justification,",
				"          Attachments = Lookuptable@Attachments,",
				"          Status,",
				"          Field_Engineer_Name = Field_Engineer,",
				"          Field_Engineer_Remarks = Lookuptable@Field_Engineer_Remarks,",
				"          Approver_1_Name = Lookuptable@Approver_1_Name,",
				"          Approver_1_Remarks = Lookuptable@Approver_1_Remarks,",
				"          Approver_1_Timestamp = Lookuptable@Approver_1_Timestamp,",
				"          Approver_2_Name = Lookuptable@Approver_2_Name,",
				"          Approver_2_Remarks = Lookuptable@Approver_2_Remarks,",
				"          Approver_2_Timestamp = Lookuptable@Approver_2_Timestamp,",
				"          Created_By = Lookuptable@Created_By,",
				"          Created_Timestamp = Lookuptable@Created_Timestamp,",
				"          Updated_By = Lookuptable@Updated_By,",
				"          Business_Unit_ID = Lookuptable@Updated_Timestamp",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> SelectBeforeSurrogateKey",
				"surrogateKey1 derive(Begin_Date = toUTC(currentTimestamp()),",
				"          End_Date = toDate('9999-12-31', 'yyyy-MM-dd'),",
				"          Current_Rec_In = 1) ~> DefaultValues",
				"DefaultValues sink(allowSchemaDrift: true,",
				"     validateSchema: true,",
				"     input(",
				"          Business_Unit as string,",
				"          Block_ID as string,",
				"          Area_Classification_1 as string,",
				"          Area_Classification_2 as string,",
				"          Plant_ID as string,",
				"          Plant_ID2 as string,",
				"          Asset_Owner as string,",
				"          Cost_Center as string,",
				"          Tier_Classification as string,",
				"          Comments as string,",
				"          Business_Justification as string,",
				"          Attachments as string,",
				"          Begin_Date as date,",
				"          End_Date as date,",
				"          Current_Rec_In as integer,",
				"          Field_Engineer_Name as string,",
				"          Field_Engineer_Remarks as string,",
				"          Approver_1_Name as string,",
				"          Approver_1_Remarks as string,",
				"          Approver_1_Timestamp as timestamp,",
				"          Approver_2_Name as string,",
				"          Approver_2_Remarks as string,",
				"          Approver_2_Timestamp as timestamp,",
				"          Created_By as string,",
				"          Created_Timestamp as timestamp,",
				"          Updated_By as string,",
				"          Updated_Timestamp as timestamp,",
				"          Business_Unit_ID as integer,",
				"          Business_Unit_Key as integer",
				"     ),",
				"     deletable:false,",
				"     insertable:true,",
				"     updateable:true,",
				"     upsertable:false,",
				"     keys:['Business_Unit_ID'],",
				"     format: 'table',",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     errorHandlingOption: 'stopOnFirstError',",
				"     mapColumn(",
				"          Business_Unit_Key = Business_Unit_key,",
				"          Business_Unit_ID,",
				"          Business_Unit,",
				"          Block_ID,",
				"          Area_Classification_1,",
				"          Area_Classification_2,",
				"          Plant_ID,",
				"          Plant_ID2,",
				"          Asset_Owner,",
				"          Cost_Center,",
				"          Tier_Classification,",
				"          Comments,",
				"          Business_Justification,",
				"          Attachments,",
				"          Begin_Date,",
				"          End_Date,",
				"          Current_Rec_In,",
				"          Field_Engineer_Name,",
				"          Field_Engineer_Remarks,",
				"          Approver_1_Name,",
				"          Approver_1_Remarks,",
				"          Approver_1_Timestamp,",
				"          Approver_2_Name,",
				"          Approver_2_Remarks,",
				"          Approver_2_Timestamp,",
				"          Created_By,",
				"          Created_Timestamp,",
				"          Updated_By,",
				"          Updated_Timestamp",
				"     )) ~> Destination"
			]
		}
	}
}